# OpenClaude æ¡Œé¢ç«¯ç™»å½•å‡çº§æ–¹æ¡ˆ

## ä¸€ã€æ ¸å¿ƒèŒè´£åˆ’åˆ†

- **openclaude æ¡Œé¢ç«¯**ï¼šç™»å½•è§¦å‘ + å›è°ƒæ¥æ”¶ + æœ¬åœ°é…ç½®å†™å…¥
- **Salerio Web**ï¼šç”¨æˆ·å­˜åœ¨æ€§åˆ¤æ–­ â†’ onboarding â†’ workspace ç®¡ç† â†’ æƒç›Šä¸ token ä¸‹å‘

### æ ¸å¿ƒæ–°å¢ä¸¤ç‚¹

1. ç™»å½•ååˆ†æ”¯ï¼šæ˜¯å¦æ–°ç”¨æˆ·
2. æœ€ç»ˆäº§ç‰©ï¼štoken + workspace_idï¼Œå¹¶å†™å…¥ `~/.openclaw/openclaw.json`

---

## äºŒã€å‡çº§åçš„æ•´ä½“æµç¨‹æ‹†è§£

### 1ï¸âƒ£ æ¡Œé¢ç«¯ç‚¹å‡»ç™»å½•ï¼ˆä¸å˜ï¼‰

openclaude å³ä¸Šè§’ã€Œç™»å½• Salerioã€â†’ æ‰“å¼€ç³»ç»Ÿæµè§ˆå™¨

æºå¸¦å‚æ•°ï¼š
- `client_id`
- `auth_callback_url`
- `device_id` / `machine_id`
- `login_trace_id`

### 2ï¸âƒ£ Web ç™»å½•æˆåŠŸåï¼šç”¨æˆ·å­˜åœ¨æ€§åˆ¤æ–­ï¼ˆæ–°å¢ï¼‰

åœ¨ Salerio Web / Auth æœåŠ¡å†…éƒ¨ï¼š

```
æ˜¯å¦å­˜åœ¨ user è®°å½•ï¼Ÿ
â”œâ”€â”€ å¦ â†’ è¿›å…¥ Onboarding æµç¨‹
â””â”€â”€ æ˜¯ â†’ æŸ¥è¯¢ workspace
```

### 3ï¸âƒ£ æ–°ç”¨æˆ·ï¼šOnboarding æµç¨‹ï¼ˆæ–°å¢é‡ç‚¹ï¼‰

Onboarding åŒ…å«çš„æ­¥éª¤ï¼š
- é€‰æ‹©è¡Œä¸š
- è®¾ç½®å¤´åƒ
- è®¾ç½®åç§°
- Connect æ•°æ®æºï¼ˆShopify / Ads / â€¦ï¼‰
- è®¢é˜…æ–¹æ¡ˆ & ç»‘å¡
- è‡ªåŠ¨åˆ›å»º Workspace
    - è®¾ä¸ºé»˜è®¤ workspace
    - ç”¨æˆ·ä¸º Owner
    - åç»­å¯é‚€è¯·æˆå‘˜

> ğŸ‘‰ Onboarding å®Œæˆæ‰ç®—"å¯ç”¨ç”¨æˆ·"

### 4ï¸âƒ£ è€ç”¨æˆ·ï¼šWorkspace è·å–é€»è¾‘ï¼ˆæ–°å¢ï¼‰

å¦‚æœç”¨æˆ·å·²å­˜åœ¨ï¼š
1. æŸ¥è¯¢è¯¥ç”¨æˆ·ä¸‹çš„ workspaces
2. æŒ‰è§„åˆ™é€‰ä¸€ä¸ªï¼ˆä¾‹å¦‚ï¼‰ï¼š
    - æœ€è¿‘æ´»è·ƒçš„
    - æœ€è¿‘åˆ›å»ºçš„

å¾—åˆ°ï¼š`workspace_id`

### 5ï¸âƒ£ æˆæƒå®Œæˆï¼šå›è°ƒæ¡Œé¢ç«¯ï¼ˆå‡çº§ï¼‰

æ­¤æ—¶ Salerio Auth æœåŠ¡ä¼šï¼š
1. ç”Ÿæˆ `auth_code`
2. åœ¨å†…éƒ¨ç»‘å®šï¼š`user_id` + `workspace_id`
3. å›è°ƒæ¡Œé¢ç«¯ï¼š`http://127.0.0.1:{port}/authorize?code=xxx`

### 6ï¸âƒ£ æ¡Œé¢ç«¯ç”¨ auth_code æ¢å–"å¢å¼º Token"ï¼ˆå‡çº§ï¼‰

æ¡Œé¢ç«¯è°ƒç”¨ï¼š`POST /oauth/token`

è¿”å›å†…å®¹å¿…é¡»åŒ…å«ï¼š

```json
{
  "access_token": "...",
  "refresh_token": "...",
  "workspace_id": "uuid",
  "skills": [],
  "expires_in": 7200
}
```

> ğŸ“Œ è¿™æ˜¯ä½ è¿™æ¬¡è®¾è®¡çš„å…³é”®ç›®æ ‡

### 7ï¸âƒ£ æ¡Œé¢ç«¯å†™å…¥æœ¬åœ°é…ç½®æ–‡ä»¶

**æ–‡ä»¶è·¯å¾„**ï¼š`~/.openclaw/openclaw.json`

**å†™å…¥é€»è¾‘**ï¼ˆåªä¿ç•™å¿…è¦å†…å®¹ï¼‰ï¼š

```json
{
  "skills": {
    "install": {
      "nodeManager": "npm"
    },
    "entries": {
      "search-data": {
        "enabled": true,
        "env": {
          "SEARCH_DATA_TOKEN": "<access_token>",
          "SEARCH_DATA_WORKSPACE_ID": "<workspace_id>"
        }
      }
    }
  }
}
```

> ğŸ“Œ æ¡Œé¢ç«¯åç»­æ‰€æœ‰ Skill æ‰§è¡Œï¼šä¸å†å…³å¿ƒç™»å½•ï¼Œåªè¯»å–è¿™ä¸ªé…ç½®æ–‡ä»¶

---

## ä¸‰ã€å‡çº§åçš„ Mermaid æ—¶åºå›¾

è¿™å¼ å›¾ = ä½ ç°åœ¨è¿™å¥—ç³»ç»Ÿçš„"æ­£å¼ç‰ˆè“å›¾"

```mermaid
sequenceDiagram
    autonumber

    participant ç”¨æˆ·
    participant æ¡Œé¢ç«¯ as openclaude æ¡Œé¢ç«¯
    participant æµè§ˆå™¨ as ç³»ç»Ÿæµè§ˆå™¨
    participant ç½‘é¡µç«¯ as Salerio ç½‘é¡µ
    participant è®¤è¯æœåŠ¡ as Salerio è®¤è¯æœåŠ¡
    participant ä¸šåŠ¡æœåŠ¡ as Salerio ä¸šåŠ¡æœåŠ¡
    participant æ¡Œé¢æ–‡ä»¶ as æœ¬åœ°é…ç½®æ–‡ä»¶ ~/.openclaw/openclaw.json

    %% ===== è§¦å‘ç™»å½• =====
    ç”¨æˆ·->>æ¡Œé¢ç«¯: ç‚¹å‡»ã€Œç™»å½• Salerioã€
    æ¡Œé¢ç«¯->>æ¡Œé¢ç«¯: ç”Ÿæˆ login_trace_id / device_id / machine_id
    æ¡Œé¢ç«¯->>æµè§ˆå™¨: æ‰“å¼€ç™»å½•é“¾æ¥ï¼ˆredirect_urlï¼‰
    æµè§ˆå™¨->>ç½‘é¡µç«¯: è®¿é—®ç™»å½•é¡µ /login
    ç”¨æˆ·->>ç½‘é¡µç«¯: å®Œæˆç™»å½•ï¼ˆè´¦å· / OAuthï¼‰

    %% ===== ç”¨æˆ·å­˜åœ¨æ€§åˆ¤æ–­ =====
    ç½‘é¡µç«¯->>ä¸šåŠ¡æœåŠ¡: æŸ¥è¯¢ç”¨æˆ·æ˜¯å¦å­˜åœ¨
    alt æ–°ç”¨æˆ·
        ä¸šåŠ¡æœåŠ¡->>ç½‘é¡µç«¯: è¿›å…¥ Onboarding æµç¨‹
        ç”¨æˆ·->>ç½‘é¡µç«¯: é€‰æ‹©è¡Œä¸š / å¤´åƒ / åç§°
        ç”¨æˆ·->>ç½‘é¡µç«¯: Connect æ•°æ®æº
        ç”¨æˆ·->>ç½‘é¡µç«¯: è®¢é˜…æ–¹æ¡ˆ & ç»‘å¡
        ä¸šåŠ¡æœåŠ¡->>ä¸šåŠ¡æœåŠ¡: åˆ›å»ºé»˜è®¤ Workspace
    else å·²æœ‰ç”¨æˆ·
        ä¸šåŠ¡æœåŠ¡->>ä¸šåŠ¡æœåŠ¡: æŸ¥è¯¢ç”¨æˆ·ä¸‹çš„ Workspace
        ä¸šåŠ¡æœåŠ¡->>ä¸šåŠ¡æœåŠ¡: è·å–æœ€æ–° Workspace
    end

    %% ===== æˆæƒä¸å›è°ƒ =====
    ç½‘é¡µç«¯->>è®¤è¯æœåŠ¡: è¯·æ±‚æˆæƒï¼ˆç»‘å®š user + workspaceï¼‰
    è®¤è¯æœåŠ¡->>è®¤è¯æœåŠ¡: ç”Ÿæˆ auth_code
    è®¤è¯æœåŠ¡->>æ¡Œé¢ç«¯: å›è°ƒæœ¬åœ°åœ°å€\n/authorize?code=auth_code

    %% ===== æ¢å– Token =====
    æ¡Œé¢ç«¯->>è®¤è¯æœåŠ¡: ä½¿ç”¨ auth_code æ¢å– Token
    è®¤è¯æœåŠ¡->>æ¡Œé¢ç«¯: access_token + workspace_id + skills

    %% ===== å†™å…¥æœ¬åœ°é…ç½® =====
    æ¡Œé¢ç«¯->>æ¡Œé¢æ–‡ä»¶: å†™å…¥ Token ä¸ Workspace é…ç½®
    æ¡Œé¢ç«¯->>æ¡Œé¢ç«¯: ç™»å½•å®Œæˆï¼ŒSkill å¯ç”¨
```
